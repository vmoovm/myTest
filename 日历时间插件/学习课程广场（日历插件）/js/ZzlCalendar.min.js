/**
 * 日历
 * @param {IDString} 追加日历的容器
 * @param {Object} 配置项
 *
 * 兼容到IE9以上
 * 更新：2019-3-4
 * 作者：张中乐
 */
function ZzlCalendar(domId,options){var that=this;var isInit=true;this.zconf={showLunarCalendar:true,initDate:null,disEvent:[],handlerId:'zcalendar',selectMonthId:'setDate',prevYearId:'prevYear',nextYearId:'nextYear',prevMonthId:'prevMonth',nextMonthId:'nextMonth',isJumpDate:true,isPastDate:false,isFutureDate:false,selectType:1,showTagName:false,onSelect:function(){},RenderHtmlFn:function(){},nothingDataFn:function(){},notNnallowedDataFn:function(){},hideFn:function(){}};for(v in this.zconf){for(b in options){if(v==b){this.zconf[v]=options[b]}}}var getChildren=function(ele){var chid=ele.childNodes;var eleMatch=[];for(var i=0,l=chid.length;i<l;i+=1){if(chid[i].nodeType==1){eleMatch.push(chid[i])}}return eleMatch};this.selectMonthDom=this.zconf.selectMonthId?document.getElementById(this.zconf.selectMonthId):false;this.myCalendar=document.getElementById(domId);this.nowDate=new Date();if(this.zconf.selectType==2){document.getElementById('zcalendarBtn').style.display='block';document.getElementById('zcalendarBtn').getElementsByTagName('p')[0].addEventListener('click',function(e){that.zconf.hideFn(e)},false)}this.syncDateDom=function(){if(this.selectMonthDom){if(this.zconf.showTagName){for(var i=0;i<getChildren(this.selectMonthDom).length;i+=1){if(getChildren(this.selectMonthDom)[i].nodeName.toLocaleLowerCase()==this.zconf.showTagName.toLocaleLowerCase()){getChildren(this.selectMonthDom)[i].setAttribute('data-year',this.year);getChildren(this.selectMonthDom)[i].setAttribute('data-month',this.month);getChildren(this.selectMonthDom)[i].innerText=this.year+'年'+this.month+'月'}}}else{this.selectMonthDom.setAttribute('data-year',this.year);this.selectMonthDom.setAttribute('data-month',this.month);this.selectMonthDom.innerText=this.year+'年'+(this.month)+'月'}}};this.syncDateDom();var parseToDOM=function(str){var div=document.createElement("div");if(typeof str=="string"){div.innerHTML=str}return div.childNodes};this.RenderCalendar=function(year,month){this.year=year;this.month=month;if(document.querySelector('.zcalendar-active')){document.querySelector('.zcalendar-active').classList.remove('zcalendar-active')}if(document.getElementById('tab'+this.year+this.month)){document.getElementById('tab'+this.year+this.month).classList.add('zcalendar-active');return}else{console.log('首次渲染'+this.year+'年'+this.month+'月日历')}if(this.year<1900){console.log('1900年前为无意义操作');return}if(this.month<1||this.month>12){console.log('月份只包含1-12，其他为无效月份');return}this.day=new Date(this.year,this.month-1,1).getDay();this.monthDays=31;if(/^2/.test(this.month)){if(this.year%400==0||(this.year%100!=0&&this.year%4==0)){this.monthDays=29}else{this.monthDays=28}}else if(/^4|6|9|11$/.test(this.month)){this.monthDays=30}var row=Math.ceil((this.monthDays+this.day)/7);var zlunarHTML='';var defindeHTML='<p></p>';var calendarHTML='';calendarHTML+='<dl class="zcalendar-tr zcalendar-line" data-week="">\
			<dt class="zcalendar-th"><dl class="zcalendar-week"><dt>日</dt></dl></dt>\
			<dt class="zcalendar-th"><dl class="zcalendar-week"><dt>一</dt></dl></dt>\
			<dt class="zcalendar-th"><dl class="zcalendar-week"><dt>二</dt></dl></dt>\
			<dt class="zcalendar-th"><dl class="zcalendar-week"><dt>三</dt></dl></dt>\
			<dt class="zcalendar-th"><dl class="zcalendar-week"><dt>四</dt></dl></dt>\
			<dt class="zcalendar-th"><dl class="zcalendar-week"><dt>五</dt></dl></dt>\
			<dt class="zcalendar-th"><dl class="zcalendar-week"><dt>六</dt></dl></dt>\
		</dl>';var nd=0;for(var r=0;r<row;r+=1){calendarHTML+='<dl class="zcalendar-tr zcalendar-darker zcalendar-line">';for(var c=0;c<7;c+=1,nd+=1){if(nd<this.day){var emptyObj=new Date(new Date(this.year,this.month-1,1).setTime(new Date(this.year,this.month-1,1).setMonth(new Date(this.year,this.month-1,1).getMonth()-1)));var emptyObj1=new Date(new Date(this.year,this.month-1,1).setTime(new Date(this.year,this.month-1,1).setDate(new Date(this.year,this.month-1,1).getDate()-this.day+nd)));if(this.zconf.showLunarCalendar){zlunarHTML='<dd class="zcalendar-lunar">'+calendar.solar2lunar(emptyObj.getFullYear(),(emptyObj.getMonth()+1),emptyObj1.getDate()).IDayCn+'</dd>'}calendarHTML+='<dd class="zcalendar-td zcalendar-light" id="wrn'+emptyObj.getFullYear()+'-'+(emptyObj.getMonth()+1)+'-'+emptyObj1.getDate()+'"><dl class="zcalendar-date"><dt class="zcalendar-solar">'+emptyObj1.getDate()+'</dt>'+zlunarHTML+'</dl><div class="zcalendar-define">'+defindeHTML+'</div></dd>'}else if(nd>=(this.monthDays+this.day)){var emptyObj=new Date(new Date(this.year,this.month+1,1).setTime(new Date(this.year,this.month+1,1).setMonth(new Date(this.year,this.month+1,1).getMonth()-1)));if(this.zconf.showLunarCalendar){zlunarHTML='<dd class="zcalendar-lunar">'+calendar.solar2lunar(emptyObj.getFullYear(),(emptyObj.getMonth()+1),(emptyObj.getDate()+nd-this.monthDays-this.day)).IDayCn+'</dd>'}calendarHTML+='<dd class="zcalendar-td zcalendar-light" id="wrn'+emptyObj.getFullYear()+'-'+(emptyObj.getMonth()+1)+'-'+(emptyObj.getDate()+nd-this.monthDays-this.day)+'"><dl class="zcalendar-date"><dt class="zcalendar-solar">'+(emptyObj.getDate()+nd-this.monthDays-this.day)+'</dt>'+zlunarHTML+'</dl><div class="zcalendar-define">'+defindeHTML+'</div></dd>'}else{if((nd-this.day+1)==this.nowDate.getDate()){if(this.zconf.showLunarCalendar){zlunarHTML='<dd class="zcalendar-lunar">'+calendar.solar2lunar(this.year,this.month,(nd-this.day+1)).IDayCn+'</dd>'}if(this.year==this.nowDate.getFullYear()&&this.month==this.nowDate.getMonth()+1){zlunarHTML='<dd class="zcalendar-lunar">今天</dd>';calendarHTML+='<dd class="zcalendar-td" id="col'+this.year+'-'+this.month+'-'+(nd-this.day+1)+'"><dl class="zcalendar-date zcalendar-today"><dt class="zcalendar-solar">'+(nd-this.day+1)+'</dt>'+zlunarHTML+'</dl><div class="zcalendar-define">'+defindeHTML+'</div></dd>'}else{calendarHTML+='<dd class="zcalendar-td" id="col'+this.year+'-'+this.month+'-'+(nd-this.day+1)+'"><dl class="zcalendar-date"><dt class="zcalendar-solar">'+(nd-this.day+1)+'</dt>'+zlunarHTML+'</dl><div class="zcalendar-define">'+defindeHTML+'</div></dd>'}}else{if(this.zconf.showLunarCalendar){zlunarHTML='<dd class="zcalendar-lunar">'+calendar.solar2lunar(this.year,this.month,(nd-this.day+1)).IDayCn+'</dd>'}calendarHTML+='<dd class="zcalendar-td" id="col'+this.year+'-'+this.month+'-'+(nd-this.day+1)+'"><dl class="zcalendar-date"><dt class="zcalendar-solar">'+(nd-this.day+1)+'</dt>'+zlunarHTML+'</dl><div class="zcalendar-define">'+defindeHTML+'</div></dd>'}}}calendarHTML+='</dl>'}var tabHTML='<div class="zcalendar-inactive zcalendar-active" id="tab'+this.year+this.month+'" >';tabHTML+=calendarHTML;tabHTML+='</div>';var DOMArray=[];DOMArray=parseToDOM(tabHTML);for(var m=0;m<DOMArray.length;m+=1){var mdom=DOMArray[m].cloneNode(true);this.myCalendar.appendChild(mdom)}if(this.zconf.RenderHtmlFn&&!isInit){this.zconf.RenderHtmlFn();}isInit=false;if(this.zconf.isPastDate&&this.year==this.nowDate.getFullYear()&&this.month==(this.nowDate.getMonth()+1)){for(var d=this.nowDate.getDate()+1;d<=this.monthDays;d+=1){document.getElementById('col'+this.year+'-'+this.month+'-'+d).classList.add('zcalendar-stop')}}var childEles=this.myCalendar.getElementsByClassName('zcalendar-td');for(var n=0;n<childEles.length;n+=1){if(childEles[n].id&&this.zconf.disEvent.indexOf(childEles[n].id.slice(3))>=0){childEles[n].classList.add('zcalendar-stop')}if(!(RegExp(' zcalendar-stop ').test(' '+childEles[n].className+' '))){childEles[n].addEventListener('click',function(e){that.date=this.id.slice(3).split('-')[2];that.zconf.onSelect({id:this.id,type:that.zconf.selectType })},false)}}childEles=null};this.toToday=function(){console.log('回到今天');that.RenderCalendar(that.nowDate.getFullYear(),that.nowDate.getMonth()+1);that.year=that.nowDate.getFullYear();that.month=that.nowDate.getMonth()+1;that.date=that.nowDate.getDate();that.syncDateDom()};if(this.zconf.initDate){this.RenderCalendar(this.zconf.initDate.split('-')[0],this.zconf.initDate.split('-')[1]);this.year=this.zconf.initDate.split('-')[0];this.month=this.zconf.initDate.split('-')[1];this.date=this.zconf.initDate.split('-')[2];this.syncDateDom()}else{this.toToday()}this.appendStaute=function(defindeOption){for(var i=0;i<defindeOption.length;i+=1){if(this.year==defindeOption[i].site.split('-')[0]&&this.month==defindeOption[i].site.split('-')[1]){document.getElementById('col'+defindeOption[i].site).getElementsByClassName('zcalendar-define')[0].className='zcalendar-define zcalendar-define'+defindeOption[i].type;if(defindeOption[i].text){document.getElementById('col'+defindeOption[i].site).getElementsByClassName('zcalendar-define')[0].innerHTML=defindeOption[i].text}}}};this.appendDefind=function(defindeOption,htmlStr){for(var i=0;i<defindeOption.length;i+=1){document.getElementById('col'+defindeOption[i]).appendChild(parseToDOM(htmlStr)[0].cloneNode())}};this.jumpYear=function(step){if((step>0)&&this.zconf.isPastDate&&this.year+1>this.nowDate.getFullYear()){if(this.zconf.nothingDataFn){this.zconf.nothingDataFn({year:this.year,type:'year'})}return}else if((step<0)&&this.zconf.isFutureDate&&(this.year-1<this.nowDate.getFullYear())){if(this.zconf.notNnallowedDataFn){this.zconf.notNnallowedDataFn({year:this.year,type:'year'})}return}if(this.year<1900){this.year=1900}else{this.year=this.year*1+step;if(this.zconf.isPastDate&&this.year+1>this.nowDate.getFullYear()){this.month=this.nowDate.getMonth()+1}else if(this.zconf.isFutureDate&&(this.year==this.nowDate.getFullYear())&&this.month<this.nowDate.getMonth()+1){this.month=this.nowDate.getMonth()+1}}this.RenderCalendar(this.year,this.month);this.syncDateDom();return this.year};this.jumpMoth=function(step){if(this.month<1||this.month>12){return}if((step>0)&&this.zconf.isPastDate&&(this.year==this.nowDate.getFullYear())&&(this.month>this.nowDate.getMonth())){if(this.zconf.nothingDataFn){this.zconf.nothingDataFn({month:this.month,type:'month'})}return false}else if((step<0)&&this.zconf.isFutureDate&&(this.year==this.nowDate.getFullYear())&&(this.month<=this.nowDate.getMonth()+1)){if(this.zconf.notNnallowedDataFn){this.zconf.notNnallowedDataFn({month:this.month,type:'month'})}return false}this.month=this.month*1+step;if(this.month<1){this.month=12;this.year=this.year*1-1}else if(this.month>12){this.month=1;this.year=this.year*1+1}this.RenderCalendar(this.year,this.month);this.syncDateDom();return this.month};this.readDate=function(str){console.log(str);this.year=str.split('-')[0];this.month=str.split('-')[1];this.date=str.split('-')[2];if(!document.getElementById('col'+str)){this.RenderCalendar(this.year,this.month)}else{if(document.querySelector('.zcalendar-active')){document.querySelector('.zcalendar-active').classList.remove('zcalendar-active')}document.getElementById('tab'+this.year+this.month).classList.add('zcalendar-active')}this.syncDateDom()};if(this.zconf.isJumpDate){if(!this.zconf.prevYearId){console.log('上翻年id为空');return false}else{document.getElementById(this.zconf.prevYearId).addEventListener('click',function(){that.jumpYear(-1)},false)}if(!this.zconf.nextYearId){console.log('下翻年id为空');return false}else{document.getElementById(this.zconf.nextYearId).addEventListener('click',function(){that.jumpYear(1)},false)}if(!this.zconf.prevMonthId){console.log('上翻年id为空');return false}else{document.getElementById(this.zconf.prevMonthId).addEventListener('click',function(){that.jumpMoth(-1)},false)}if(!this.zconf.nextMonthId){console.log('下翻年id为空');return false}else{document.getElementById(this.zconf.nextMonthId).addEventListener('click',function(){that.jumpMoth(1)},false)}}}